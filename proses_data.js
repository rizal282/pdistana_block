$(document).ready(function(){
    // setInterval(my_reload(), 1000);

    function my_reload(){
        window.location = location.href;
    }


    $("#tgl_awal").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    
    $("#tgl_akhir").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_lahir").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#expired").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_service").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_kerja").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#filter_tgl").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_beli").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_gaji").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    // $("#tgl_tempobahanbaku").datepicker({
    //     yearRange: "-100:+0",
    //     changeMonth: true,
    //     changeYear: true
    // });
    $("#tgl_awalsuratjalan").datepicker({
       yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_akhirsuratjalan").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_kasbon").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_beli").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_tempobb").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_tempo").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tglbelibahanbaku").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tanggalbb").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_service").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tanggalrekkoran").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_bayar").datepicker({
       yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_suratjln").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tglawalproduksi").datepicker({
       yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tglakhirproduksi").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_akhirpemasukan").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tanggalkerjatambahan").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tglterjualawal").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tglterjualakhir").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_awalstock").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_akhirstock").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_awaltempopembeli").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_akhirtempopembeli").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_awalbelibahanbaku").datepicker({
        yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#tgl_akhirbelibahanbaku").datepicker({
       yearRange: "-100:+100",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    $("#ubahtgltempopembeli").datepicker({
        yearRange: "-100:+100",
         changeMonth: true,
         changeYear: true,
         dateFormat: 'dd-mm-yy'
     });

     $("#tgl_awalkasbesar").datepicker({
        yearRange: "-100:+100",
         changeMonth: true,
         changeYear: true,
         dateFormat: 'dd-mm-yy'
     });

     $("#tgl_akhirkasbesar").datepicker({
        yearRange: "-100:+100",
         changeMonth: true,
         changeYear: true,
         dateFormat: 'dd-mm-yy'
     });

     $("#tglhistoriproduksiawal").datepicker({
        yearRange: "-100:+100",
         changeMonth: true,
         changeYear: true,
         dateFormat: 'dd-mm-yy'
     });

     $("#tglhistoriproduksiakhir").datepicker({
        yearRange: "-100:+100",
         changeMonth: true,
         changeYear: true,
         dateFormat: 'dd-mm-yy'
     });


    $("#namastock_barang").on("change", function(){
        var nama_brg = $(this).val();

        $.ajax({
            url: "proses_ambil_valuebrg.php",
            data: {"nama_brg":nama_brg},
            // dataType: "json",
            type: "POST",
            success: function(val){
                // alert(val);
                // var databarang = val;

                // obj = JSON.parse(databarang);

                $('#kode_stockbrg').val(val);
                // $('#stockakhirbrg').val(obj.stock_akhir);
                // alert(obj.stock_akhir);
            }
        });
    });


    // filter data surat jalan

    $("#tgl_akhirsuratjalan").on("change", function(){
        var tgl_awalsuratjalan = $("#tgl_awalsuratjalan").val();
        var tgl_akhirsuratjalan = $(this).val();

        $.ajax({
            url: "proses_filterdata_suratjalan.php",
            method: "POST",
            data: {"tgl_awalsuratjalan":tgl_awalsuratjalan, "tgl_akhirsuratjalan":tgl_akhirsuratjalan},
            success: function(data){
                $("#filterdatasuratjalan").html(data);
            }
        });
    });

    // end

    $("#detail_notif").click(function(){
        var tgl_tempo = $("#tgl_tempo").val();

        $.ajax({
            url: "proses_update_setting.php",
            type: "POST",
            data: {"tgl_tempo":tgl_tempo},
            success: function(){

            }
        });
    });

    // $('#tambahBrgRusak').hide();
    $('#tgl_tempopembeli').hide();

    $('#pembayaran').on("change", function(){
        var pembayaran = $(this).val();

        if(pembayaran == "Tempo"){
            $('#tgl_tempopembeli').show();
        }else{
            $('#tgl_tempopembeli').hide();
        }
    });

    // ini untuk order pembeli
    $("#tambah_beli").click(function(){

    	var kode_tr = $("#no_transaksi").val();
    	var kode_brg = $("#kode_brg").val();

        var nama_brg = $("#nama_brg").val();
        var jenis_brg = $("#jenis_brg").val();
        var warna_brg = $("#warna_brg").val();
		var hrg_brg = $("#hrg_brg").val();
		// var stockakhirbrg = $("#stockakhirbrg").val();
        var jumlah_beli = $("#jumlah_beli").val();
        var totalstock = $("#totalstock").val();
        var satuan = $("#satuan").val();
        var sumber_brg = $("#sumber_brg").val();
        // alert(stockakhirbrg);

        if(parseInt(totalstock) < parseInt(jumlah_beli) && sumber_brg == "Internal"){
            alert("Stock Barang Kurang. Pembelian Tidak Bisa Dilanjutkan!");
        }else{
            if(nama_brg != "Pilih :"){
                if (jenis_brg != "Pilih :") {
                    if(warna_brg != ""){
                        if (hrg_brg != "") {
                            if (jumlah_beli != "") {
                                $.ajax({
                                    url : "proses_tambah_detail_beli.php",
                                    method : "POST",
                                    data : {"no_transaksi":kode_tr, "kode_barang":kode_brg, "nama_barang":nama_brg, "jenis_brg":jenis_brg, "warna_brg":warna_brg, "hrg_barang":hrg_brg, "jumlah_beli":jumlah_beli, "satuan":satuan, "sumber_brg":sumber_brg},
                                    success:function(msg){
                                        alert("Detail Pembelian Barang Sudah Ditambahkan");
                                        //$("#no_transaksi").val("");
                                        // $("#kode_brg").val("");
                                        // $("#nama_brg").val("");
                                        // $("#hrg_brg").val("");
                                        // $("#jumlah_beli").val("");
                                        // $("#sumber_brg").val("");
                    
                                        $("#output").after(msg).hide().appendTo('#output');
                                        $("#formtambahbarangbeli").find("input[name=nama_brg], input[name=totalstock], input[name=hrg_brg], input[name=jumlah_beli]").val("");
                                        $("#alert_stock").html("");
                    
                                    }
                                });
                            } else {
                                alert("Jumlah Beli Belum Dimasukkan!");
                            }   
                        } else {
                            alert("Harga Barang Belum Dimasukkan!");
                        }
                    }else{
                        alert("Warna Barang Belum Dimasukkan!");
                    }
                } else {
                    alert("Jenis Barang Belum Dipilih!");
                }
            }else{
                alert("Nama Barang Belum Dipilih!");
            }
        }

    });

    $("#selesaibeli").click(function(){
        $("#formtambahbarangbeli").find("input[name=nama_brg], input[name=totalstock], input[name=hrg_brg], input[name=jumlah_beli]").val("");
        $("#alert_stock").html("");
    });

    // menyembunyikan alert stok ketika eksternal
    $("#sumber_brg").on("change", function(){
        var sumber_brg = $(this).val();

        if(sumber_brg == "Eksternal"){
            $("#alert_stock").hide();
        }else{
            $("#alert_stock").show();
        }
    });

    $("#tambahlagi_beli").click(function(){
        // alert("tes");
        var tambahlagibarang = $("#tambahlagibarang").val();
        var no_transaksi = $("#trdetailbeli").text();
        var kode_brg = $("#kode_brg").val();

        var nama_brg = $("#nama_brg").val();
        var jenis_brg = $("#jenis_brg").val();
        var warna_brg = $("#warna_brg").val();
		var hrg_brg = $("#hrg_brg").val();
		// var stockakhirbrg = $("#stockakhirbrg").val();
        var jumlah_beli = $("#jumlah_beli").val();
        var totalstock = $("#totalstock").val();
        var satuan = $("#satuan").val();
        var sumber_brg = $("#sumber_brg").val();
        // alert(stockakhirbrg);

        if(parseInt(totalstock) < parseInt(jumlah_beli) && sumber_brg == "Internal"){
            alert("Stock Barang Kurang. Pembelian Tidak Bisa Dilanjutkan!");
        }else{
            if(nama_brg != "Pilih :"){
                if (jenis_brg != "Pilih :") {
                    if(warna_brg != ""){
                        if (hrg_brg != "") {
                            if (jumlah_beli != "") {
                                $.ajax({
                                    url : "proses_tambahlagidetail_beli.php",
                                    method : "POST",
                                    data : {"tambahlagibarang":tambahlagibarang,"no_transaksi":no_transaksi, "kode_barang":kode_brg, "nama_barang":nama_brg, "jenis_brg":jenis_brg, "warna_brg":warna_brg, "hrg_barang":hrg_brg, "jumlah_beli":jumlah_beli, "satuan":satuan, "sumber_brg":sumber_brg},
                                    success:function(msg){
                                        alert("Detail Pembelian Barang Sudah Ditambahkan");
                                        //$("#no_transaksi").val("");
                                        // $("#kode_brg").val("");
                                        // $("#nama_brg").val("");
                                        // $("#hrg_brg").val("");
                                        // $("#jumlah_beli").val("");
                                        // $("#sumber_brg").val("");
                    
                                        // $("#detailbelibrg").after(msg).hide().appendTo('#detailbelibrg');
                                        $("#detailbelibrg").html(msg);
                                        $("#formtambahbarangbeli").find("input[name=nama_brg], input[name=totalstock], input[name=hrg_brg], input[name=jumlah_beli]").val("");
                                        $("#alert_stock").html("");
                    
                                    }
                                });
                            } else {
                                alert("Jumlah Beli Belum Dimasukkan!");
                            }   
                        } else {
                            alert("Harga Barang Belum Dimasukkan!");
                        }
                    }else{
                        alert("Warna Barang Belum Dimasukkan!");
                    }
                } else {
                    alert("Jenis Barang Belum Dipilih!");
                }
            }else{
                alert("Nama Barang Belum Dipilih!");
            }
        }

    });

    // ini untuk order bahan baku
    $("#tambah_bahanbaku").click(function(){

        var notrbahanbaku = $("#notrbahanbaku").val();
        var kode_brgbahanbaku = $("#kode_brgbahanbaku").val();
        var nama_bahanbaku = $("#nama_bahanbaku").val();
        var hrg_bahanbaku = $("#hrg_bahanbaku").val();
        var jumlah_bahanbaku = $("#jumlah_bahanbaku").val();
        // var satuan_bahanbaku = $("#satuan_bahanbaku").val();
        // alert(nama_brg);

        // alert(jumlah_bahanbaku);

        $.ajax({
            url : "proses_tambah_detail_belibahanbaku.php",
            method : "POST",
            data : {"notrbahanbaku":notrbahanbaku, "kode_brgbahanbaku":kode_brgbahanbaku, "nama_bahanbaku":nama_bahanbaku, "hrg_bahanbaku":hrg_bahanbaku, "jumlah_bahanbaku":jumlah_bahanbaku},
            success:function(msg){
                //$("#no_transaksi").val("");
                // $("#kode_brg").val("");
                // $("#nama_brg").val("");
                // $("#hrg_brg").val("");
                // $("#jumlah_beli").val("");
                // $("#sumber_brg").val("");
                $("#outputbelibahanbaku").after(msg).hide().appendTo('#outputbelibahanbaku');
            }
        });
    });

    // untuk kas kecil
    $("#ya").click(function(){
    	var selisihkaskecil = $("#selisihkaskecil").val();


		$.ajax({
			url : "proses_reset_kaskecil.php",
			method : "POST",
			data : {"selisihkaskecil":selisihkaskecil},
			success:function(msg){
				alert("berhasil di Reset");
                $("#resetkaskecil").html(msg);
			}
		});
    });


    // untuk kas besar
    $("#topup").click(function(){
    	var nominaltopup = $("#nominaltopup").val();


		$.ajax({
			url : "proses_topup_kasbesar.php",
			method : "POST",
			data : {"nominaltopup":nominaltopup},
			success:function(msg){
                var kas = msg;
                obj = JSON.parse(kas);

				alert("berhasil di Top Up");
                $("#resettopupkasbesar").html(obj.kasbesar);
                $("#kasbankbaru").html(obj.kasbank);
			}
		});
    });



    $("#nama_brg").on("change", function(){
        var nama_brg = $(this).val();

        $.ajax({
            url: "proses_ambil_valuebrg.php",
            data: {"nama_brg":nama_brg},
            // dataType: "json",
            type: "POST",
            success: function(val){
                // alert(val);

                $('input[name="kode_brg"]').val(val);
            }
        });
    });

    // ketika jumlah barang yang dibeli
    $("#jumlah_beli").keyup(function(){
        var kode_brg = $("#kode_brg").val();
        var jenis_brg = $("#jenis_brg").val();
        var jumlah_beli = $(this).val();

        if (jenis_brg == "Pilih :") {
            alert("Jenis Barang Belum Dipilih!");
        } else {
            $.ajax({
                url: "proses_cek_stock.php",
                method: "POST",
                data: {"kode_brg":kode_brg, "jenis_brg":jenis_brg, "jumlah_beli":jumlah_beli},
                success: function(e){
                    // $("#alert_stock").html(e);
                    var hasil = e;
                    obj = JSON.parse(hasil);
    
                    $("#alert_stock").html(obj.alert);
                    $("#totalstock").val(obj.btn);
    
                }
            });
        }
    });

    // ambil nama supir
    //ambil id supir

    $('#nama_supir').on('change', function(){
        var nama_supir = $(this).val();

        $.ajax({
            url: "proses_ambil_idsupir.php",
            type: "POST",
            data: {"nama_supir":nama_supir},
            success: function(data){
                // alert(data);
                $('#id_supir').val(data);
            }
        });
    });

     $("#nama_karyawan").on("change", function(){
        var nama_karyawan = $(this).val();

        $.ajax({
            url: "proses_ambil_idkrykasbon.php",
            data: {"nama_kry":nama_karyawan},
            type: "POST",
            success: function(eval){
                // var dataidkry = eval;
                // obj = JSON.parse(dataidkry);

                $('input[name="id_kry"]').val(eval);
                // alert(eval);
            }
        });
    });

     $("#nama_karyawanproduksi").on("change", function(){
        var nama_karyawan = $(this).val();

        $.ajax({
            url: "proses_ambil_idkryproduksi.php",
            data: {"nama_kry":nama_karyawan},
            type: "POST",
            success: function(eval){
                // var dataidkry = eval;
                // obj = JSON.parse(dataidkry);

                $('#id_kryproduksi').val(eval);
                // alert(eval);
            }
        });
    });

    // bagian ambil id wilayah

     $("#wilayah").on("change", function(){
        var wilayah = $(this).val();

        $.ajax({
            url: "proses_ambil_idwilayah.php",
            data: "id_wilayah="+wilayah,
            dataType: "json",
            type: "POST",
            success: function(val){
                $("#id_wilayah").val(val);
                // alert(val);
            }
        });
    });

     $("#edit_wilayah").on("change", function(){
        var wilayah = $(this).val();

        $.ajax({
            url: "proses_ambil_idwilayah.php",
            data: "id_wilayah="+wilayah,
            dataType: "json",
            type: "POST",
            success: function(val){
                $("#idedit_wilayah").val(val);
                // $("#id_wilayah").val(val);
                // alert(val);
            }
        });
    });

     $("#nudigaji").on("change", function(){
        var nama_karyawan = $(this).val();

        $.ajax({
            url: "proses_ambil_idkry.php",
            data: {"nama_kry":nama_karyawan},
            type: "POST",
            success: function(val){
                // $('#id_nudigaji').val(val);
                var groupkry = val;
                obj = JSON.parse(groupkry);

                $('#id_nudigaji').val(obj.idkry);
                $('#group_kry').val(obj.group);
                $('#tglkasbon_kry').val(obj.tanggalkasbon);

                // alert(obj.idkry);
             }
        });
    });

    $("#nudigajisl").on("change", function(){
        var nama_karyawan = $(this).val();

        $.ajax({
            url: "proses_hitunggaji_karyawanstafflapangan.php",
            data: {"nama_kry":nama_karyawan},
            type: "POST",
            success: function(val){
                // $('#id_nudigaji').val(val);
                var groupkry = val;
                obj = JSON.parse(groupkry);

                // alert(obj.total_kasbon);

                var utang;

                if(obj.total_kasbon == null){
                    utang = 0;
                }else{
                    utang = obj.total_kasbon;
                }

                $('#id_nudigajisl').val(obj.idkry);
                $('#group_kry').val(obj.group);
                $('#total_upahsl').val(obj.total_upah);
                $('#total_kasbonsl').val(utang);
                $("#idkasbon").val(obj.idkasbon)
             }
        });
    });

    // set kalender penggajian datepicker
    $("#tgl_awalperiodegaji").datepicker({
        yearRange: "-100:+0",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });
    $("#tgl_akhirperiodegaji").datepicker({
        yearRange: "-100:+0",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy'
    });

    // penggajian karyawan tetap
    $("#tgl_akhirperiodegaji").on("change", function(){
        var id_kry = $("#id_nudigaji").val();
        var namakry_gaji = $("#nudigaji").val();
        var group_kry = $("#group_kry").val();
        var tgl_gaji = $("#tgl_gaji").val();
        var tgl_awalperiodegaji = $("#tgl_awalperiodegaji").val();
        var tgl_akhirperiodegaji = $(this).val();

        $.ajax({
            url: "proses_hitunggaji_karyawantetap.php",
            type: "POST",
            data: {"id_kry":id_kry, "namakry_gaji":namakry_gaji, "tgl_gaji":tgl_gaji, "group_kry":group_kry, "tgl_awalperiodegaji":tgl_awalperiodegaji, "tgl_akhirperiodegaji":tgl_akhirperiodegaji},
            success: function(hasil){
                // alert(hasil);
                // $("#total_upah").val(hasil);

                var datajson = hasil;
                obj = JSON.parse(datajson);

                var utang, upah;

                if(obj.total_kasbon == null){
                    utang = 0;
                }else{
                    utang = obj.total_kasbon;
                }

                if(obj.total_upah == null){
                  upah = 0;
                }else{
                  upah = obj.total_upah;
                }

                // alert(upah);
                $("#total_upah").val(upah);
                $("#total_kasbon").val(utang);
                $("#idkasbon").val(obj.idkasbon);
            }
        });
     });


    $("#diskon").keypress(function(event){
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(keycode == '13'){
            var diskon = $(this).val();
            var grandtotal = $("#grandtotal").val();
            var notrpembeli = $("#notrpembeli").text();
            var sudahdiskon = "diskon";

            $.ajax({
                url: "proses_input_doskon.php",
                data: {"notrpembeli":notrpembeli,"diskon":diskon, "grandtotal":grandtotal,"sudahdiskon":sudahdiskon},
                type: "POST",
                success: function(val){
                    // $("#sisa_total").after(val).hide().appendTo('#sisa_total');
                    $("#sisa_total").html(val);

                    var f = document.createElement('form');
                    f.action= $("#url").val();
                    f.method='POST';
                    // f.target='_blank';

                    var i=document.createElement('input');
                    i.type='hidden';
                    i.name='menu';
                    i.value='detailpembeli';

                    var j=document.createElement('input');
                    j.type='hidden';
                    j.name='notrbeli';
                    j.value = notrpembeli;

                    f.appendChild(i);
                    f.appendChild(j);

                    document.body.appendChild(f);
                    f.submit();
                }
            });
        }
    });

    $('#formaddbarang').hide();

    $("#barang_rusak").on("change", function(){
        var barang_rusak = $(this).val();

        if(barang_rusak == "Ada"){
            $('#formaddbarang').show();
        }else{
            $('#formaddbarang').hide();
        }
    });

    // $("#inp_uangrefund").hide();
    $("#methodbayar").hide();
    // $("#inp_uangrefund").hide();

    $("#refund").on("change", function(){
        var refund = $(this).val();

        if(refund == "Refund Uang"){
            $("#methodbayar").show();
            $("#inp_uangrefund").show();
        }else{
            $("#methodbayar").hide();
            $("#inp_uangrefund").hide();
        }
    });

    // $("#inp_cashtr").on("change", function(){
    //     var inp_cashtr = $(this).val();

    //     if(inp_cashtr == "Cash"){
    //         $("#inp_uangrefund").show();
    //     }else{
    //         $("#inp_uangrefund").hide();
    //     }
    // });

    $("#input_brgrusak").click(function(){
        var no_trfeedback = $("#no_trfeedback").val();
        var kode_brg = $("#kode_brg").val();
        var nama_brg = $("#nama_brg").val();
        var qty_brg = $("#qty_brg").val();
        var stn_brg = $("#stn_brg").val();
        var sumber_brg = $("#sumber_brg").val();
        var refund = $("#refund").val();
        var uangrefund = $("#uangrefund").val();
        var byr_refund = $("#byr_refund").val();

        $.ajax({
            url: "proses_input_barangrusak.php",
            method: "POST",
            data: {"no_trfeedback":no_trfeedback,"kode_brg":kode_brg,"nama_brg":nama_brg,"qty_brg":qty_brg,"stn_brg":stn_brg, "sumber_brg":sumber_brg,"refund":refund,"uangrefund":uangrefund,"byr_refund":byr_refund},
            success: function(e){
                $("#databarangrusak").html(e);
            }
        });
    });

    // $("#byr_refund").on("change", function(){
    //     var byr_refund = $(this).val();

    //     if(byr_refund == "Cash"){
    //         $("#inp_uangrefund").show();
    //     }else{
    //         $("#inp_uangrefund").hide();
    //     }
    // });

    // start ajax proses update setting
    $("#set_limit_kaskecil").keypress(function(event){
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(keycode == '13'){
            var limitkaskecil = $(this).val();

            var konfirmasi = confirm("Anda Yakin Ingin Merubah Limit Kas Kecil?");

            if(konfirmasi == true){
                $.ajax({
                    url: "proses_update_setting.php",
                    type: "POST",
                    data: {"limitkaskecil":limitkaskecil},
                    success: function(e){
                        // alert(e);
                        $("#current_limit").val(e);
                        alert("Limit Kas Kecil Sudah Diperbarui");
                    }
                });
            }
        }
    });

    $("#ubahsettingtempopembeli").click(function(){
        var settingtempopembeli = $("#settingtempopembeli").val();

        $.ajax({
            url : "proses_update_setting.php",
            type : "POST",
            data : {"settingtempopembeli":settingtempopembeli},
            success : function(data){
                alert("Limit Tempo Pembeli Sudah Diubah");
                $("#settingtempopembeli").val(data);
            }
        });
    });

    // end ajax proses update setting


    // membuat preview laporan pemasukan
    $("#tgl_akhirpemasukan").on("change",function(){
        var tgl_awal = $("#tgl_awal").val();
        var tgl_akhirpemasukan = $(this).val();

        $.ajax({
            url: "preview_laporan_pemasukan.php",
            type: "POST",
            data: {"tgl_awal":tgl_awal, "tgl_akhir":tgl_akhirpemasukan},
            success: function(e){
                $("#previewlaporan").html(e);
            }
        });
    });

    // ambil rekening koran
    $("#ambilrekkoran").click(function(){
        var tgl_awal = $("#tgl_awal").val();
        var tgl_akhir = $("#tgl_akhir").val();

        $.ajax({
            url: "proses_ambil_rekkoran.php",
            type: "POST",
            data: {"tgl_awal":tgl_awal, "tgl_akhir":tgl_akhir},
            success: function(data){
                $("#previewrekkoran").html(data);
            }
        });
    });



    $("#bayar_kasbon").keyup(function(){
        if(total_kasbon == 0){
            if(bayar_kasbon != 0){
                alert("Jangan Memasukkan Angka Selain 0 Jika Tidak Ada Kasbon!");
            }
        }
            var bayar_kasbon = $(this).val();
            var total_kasbon = $("#total_kasbon").val();
            var total_upah = $("#total_upah").val();

            $.ajax({
            url : "proses_konversi_nominal.php",
            type : "POST",
            data : {"totalkasbon":total_kasbon, "bayar_kasbon":bayar_kasbon, "total_upah":total_upah},
            success : function(data) {
                var data_upah = data;
                obj = JSON.parse(data_upah);

                if(obj.totalkasbon == 0){
                    if(obj.bayarkasbon != 0){
                        alert(obj.alertkasbon);
                    }else{
                        $("#sisa_upahsl").val(obj.sisa_upah);
                        $("#sisa_kasbonsl").val(obj.sisa_kasbon);
                    }
                }else{
                    $("#sisa_upah").val(obj.sisa_upah);
                    $("#sisa_kasbon").val(obj.sisa_kasbon);
                }
            }
        });          
    });

    $("#bayar_kasbonsl").keyup(function(){
        // var konfirmasi = confirm("Anda Yakin Ingin Menambahkan Level Karyawan?");
        // var sisa_upah = total_upah - bayar_kasbon;
        // var sisakasbon = total_kasbonsl - bayar_kasbon;

        // if(total_kasbonsl == 0){
        //     if(bayar_kasbon != 0){
        //         alert("Jangan Memasukkan Angka Selain 0 Jika Tidak Ada Kasbon!");
        //     }
        // }
        
        var total_kasbonsl = $("#total_kasbonsl").val();
        var bayar_kasbon = $(this).val();
        var total_upah = $("#total_upahsl").val();

        $.ajax({
            url : "proses_konversi_nominal.php",
            type : "POST",
            data : {"totalkasbon":total_kasbonsl, "bayar_kasbon":bayar_kasbon, "total_upah":total_upah},
            success : function(data) {
                var data_upah = data;
                obj = JSON.parse(data_upah);

                if(obj.totalkasbon == 0){
                    if(obj.bayarkasbon != 0){
                        alert(obj.alertkasbon);
                    }else{
                        $("#sisa_upahsl").val(obj.sisa_upah);
                        $("#sisa_kasbonsl").val(obj.sisa_kasbon);
                    }
                }else{
                    $("#sisa_upahsl").val(obj.sisa_upah);
                    $("#sisa_kasbonsl").val(obj.sisa_kasbon);
                }
            }
        });
    });

    // untuk menampilkan preview laporan keuangan
    $("#tgl_awalkeuangan").datepicker({
        yearRange: "-100:+0",
        changeMonth: true,
        changeYear: true
    });
    $("#tgl_akhirkeuangan").datepicker({
        yearRange: "-100:+0",
        changeMonth: true,
        changeYear: true
    });

    $("#tgl_akhirkeuangan").on("change", function(){
        var tgl_awalkeuangan = $("#tgl_awalkeuangan").val();
        var tgl_akhirkeuangan = $(this).val();

        $.ajax({
            url: "proses_ambil_data_keuangan.php",
            type: "POST",
            data: {"tgl_awalkeuangan":tgl_awalkeuangan, "tgl_akhirkeuangan":tgl_akhirkeuangan},
            success: function(data){
                $("#previewlaporankeuangan").html(data);
            }
        });
    });

    $("#tgl_akhirstock").on("change", function(){
        var tgl_awalstock = $("#tgl_awalstock").val();
        var tgl_akhirstock = $(this).val();

        $.ajax({
            url: "proses_ambil_data_stock.php",
            type: "POST",
            data: {"tgl_awalstock":tgl_awalstock, "tgl_akhirstock":tgl_akhirstock},
            success: function(data){
                $("#previewlaporanstock").html(data);
            }
        });
    });

    // lihat laporan pembeli tempo yang belum Lunas

    $("#tgl_akhirtempopembeli").on("change", function(){
      var tglawalpembelitempo = $("#tgl_awaltempopembeli").val();
      var tglakhirpembelitempo = $(this).val();

      $.ajax({
        url : "proses_ambil_datapembeli_tempo.php",
        type : "POST",
        data : {"tglawalpembelitempo":tglawalpembelitempo, "tglakhirpembelitempo":tglakhirpembelitempo},
        success : function(data){
          $("#previewlaporantempopembeli").html(data);
        }
      });
    });

    // $("#hapus_detailbrg").click(function(){
    //     var id_detail = $("#id_detail").val();
    //     var hapus_kode_barang = $("#hapus_kode_barang").val();

    //     var konfirmasi = confirm("Anda Yakin Akan Menghapus Barang Ini?");

    //     if(konfirmasi == true){
    //         $.ajax({
    //             url: "proses_hapus_detailorder.php",
    //             method: "POST",
    //             data: {"id_detail":id_detail, "hapus_kode_barang":hapus_kode_barang},
    //             success: function(e){
    //                 alert(e);
    //             }
    //         });
    //     }
    // });

    $("#tgl_tempobahanbaku").hide();


    $("#pembayaranbahanbaku").on("change", function(){
        var pembayaranbahanbaku = $(this).val();

        if(pembayaranbahanbaku == "Tunai"){
            $("#tgl_tempobahanbaku").hide();
        }else{
            $("#tgl_tempobahanbaku").show();
        }
    });

    $("#suratjalanfeedback").hide();

    $("#btn_suratjalanfeedback").click(function(){
        $("#suratjalanfeedback").fadeIn();
    });

    var stock_awal, stock_masuk, angka_awal, angka_masuk, terjual, totalstockakhir;

    $("#stock_awal").keyup(function(){
        angka_awal = $(this).val();

        if(angka_awal != ""){
            stock_awal = angka_awal;
        }else{
            stock_awal = 0
        }

        angka_masuk = $("#stock_masuk").val();

        if(angka_masuk != ""){
            stock_masuk = angka_masuk;
        }else{
            stock_masuk = 0;
        }

        terjual = $("#terjual").val();

        totalstockakhir = parseInt(stock_awal) + parseInt(stock_masuk) - terjual;
        $("#stock_akhir").val(totalstockakhir);
    });

    $("#stock_masuk").keyup(function(){
        angka_awal = $("#stock_awal").val();

        if(angka_awal != ""){
            stock_awal = angka_awal;
        }else{
            stock_awal = 0
        }


        angka_masuk = $(this).val();

        if(angka_masuk != ""){
            stock_masuk = angka_masuk;
        }else{
            stock_masuk = 0;
        }

        terjual = $("#terjual").val();

        totalstockakhir = parseInt(stock_awal) + parseInt(stock_masuk) - terjual;
        $("#stock_akhir").val(totalstockakhir);
    });

    $("#terjual").keyup(function(){
        angka_awal = $("#stock_awal").val();

        if(angka_awal != ""){
            stock_awal = angka_awal;
        }else{
            stock_awal = 0
        }

        angka_masuk = $("#stock_masuk").val();

        if(angka_masuk != ""){
            stock_masuk = angka_masuk;
        }else{
            stock_masuk = 0;
        }

        terjual = $(this).val();

        totalstockakhir = parseInt(stock_awal) + parseInt(stock_masuk) - terjual;
        $("#stock_akhir").val(totalstockakhir);
    });

    // filter barang terjual
    $("#tglterjualakhir").on("change", function(){
        var tglterjualawal = $("#tglterjualawal").val();
        var tglterjualakhir = $(this).val();

        $.ajax({
            url: "proses_filter_stockterjual.php",
            type: "POST",
            data: {"tglterjualawal":tglterjualawal, "tglterjualakhir":tglterjualakhir},
            success: function(data){
                $("#filterterjual").html(data);
            }
        });
    });

    $("#pass_staff").hide();

    $("#group_kry").on("change", function(){
        var group_kry = $(this).val();

        if(group_kry == "Staff"){
            $("#pass_staff").show();
        }else{
            $("#pass_staff").hide();
        }
    });

    // ganti password admin
    $("#ganti_passadmin").click(function(){
        var pass_lama = $("#pass_lama").val();
        var pass_baru = $("#pass_baru").val();
        var ulangpass_baru = $("#ulangpass_baru").val();

        $.ajax({
            url: "proses_ganti_passadmin.php",
            type: "POST",
            data: {"pass_lama":pass_lama, "pass_baru":pass_baru, "ulangpass_baru":ulangpass_baru},
            success: function(data){
                alert(data);
            }
        });
    });

    // ganti password staff
    $("#ganti_pass_staff").click(function(){
        var id_staff = $("#id_staff").val();
        var pass_lama = $("#pass_lama").val();
        var pass_baru = $("#pass_baru").val();
        var ulangpass_baru = $("#ulangpass_baru").val();

        if(pass_lama != "" && pass_baru != "" && ulangpass_baru != ""){
            if(pass_baru == ulangpass_baru){
                var konfirmasi = confirm("Anda Yakin Mau Mengganti Password?");

                if(konfirmasi == true){
                    $.ajax({
                        url: "proses_ganti_pass_staff.php",
                        type: "POST",
                        data: {"id_staff":id_staff,"pass_lama":pass_lama, "pass_baru":pass_baru, "ulangpass_baru":ulangpass_baru},
                        success: function(data){
                            alert(data);
                        }
                    });
                }
            }else{
                alert("Ulang Password Baru Tidak Sama");
            }
        }else{
            alert("Field Password Masih Kosong!");
        }
    });

    $("#btntambahjenis").click(function(){
      var nama_jenis = $("#tambahjenisbrg").val();

      $.ajax({
        url : "proses_tambah_jenisbarang.php",
        type : "POST",
        data :{"nama_jenis":nama_jenis},
        success : function(e){
          alert(e);
        }
      });
    });

    // laporan beli bahan baku
    $("#tgl_akhirbelibahanbaku").on("change", function(){
      var tgl_awalbelibahanbaku = $("#tgl_awalbelibahanbaku").val();
      var tgl_akhirbelibahanbaku = $(this).val();

      $.ajax({
        url : "proses_ambil_pembelian_bahanbaku.php",
        type : "POST",
        data : {"tgl_awalbelibahanbaku":tgl_awalbelibahanbaku, "tgl_akhirbelibahanbaku":tgl_akhirbelibahanbaku},
        success : function(data){
          $("#previewlaporanbelibahanbaku").html(data);
        }
      });
    });

    // filter stock harian form paving
    $("#pekerjaanpaving").hide();
    $("#pekerjaannonpaving").hide();

    $("#jenisbarang").on("change", function(){
        var jenisbarang = $(this).val();
        
        if(jenisbarang == "Paving" || jenisbarang == "U-Ditch" || jenisbarang == "Greffel" || jenisbarang == "Cover Buis" || jenisbarang == "Cover U-Ditch" || jenisbarang == "Buis"){
            $("#pekerjaanpaving").show();
            $("#pekerjaannonpaving").hide();
        }else{
            $("#pekerjaanpaving").hide();
            $("#pekerjaannonpaving").show();
        }
    });

    $("#tgl_akhirkasbesar").on("change", function(){
        var tgl_awalkasbesar = $("#tgl_awalkasbesar").val();
        var tgl_akhirkasbesar = $(this).val();

        $.ajax({
            url : "proses_ambil_laporankasbesar.php",
            type : "POST",
            data : {"tgl_awal":tgl_awalkasbesar, "tgl_akhir":tgl_akhirkasbesar},
            success : function(data){
                $("#previewlaporankasbesar").html(data);
            }
        });
    });

    // add temp bayar kasbon
    $("#tambahbyrkasbonkry").click(function(){
        var kasbonnmkaryawan = $("#kasbonnmkaryawan").val();
        var byrkasbon = $("#nominalbyrkasbon").val();

        if(kasbonnmkaryawan == "Pilih :"){
            alert("Pilih nama karyawan yang kasbon");
        }else{
            if(byrkasbon == ""){
                alert("Masukan nominal bayar kasbon");
            }else{
                $.ajax({
                    url : "proses_tambahbayar_tempkasbon.php",
                    type : "POST",
                    data : {"kasbonnmkaryawan":kasbonnmkaryawan, "byrkasbon":byrkasbon},
                    success : function(data){
                        // $("#datatempkasbon").html(data);
                        alert("Data ditambah");
                    }
                });
            }
        }
    });

    $("#lihatbyrkasbonkry").click(function(){
        $.ajax({
            url : "lihatdata_bayar_tempkasbon.php",
            success : function(data){
                $("#datatempkasbon").html(data);
                var totalgaji = $("#total_upah").val();
                var totalbayarkasbon = $("#totalbayarkasbon").val();
                var sisaupah = totalgaji - totalbayarkasbon;
                $("#sisa_upah").val(sisaupah);
                // alert(sisaupah);
            }
        });
    });
            
    $(function(){

        // untuk penggajian kasbon
        $(document).on("click","td",function(){
            $(this).find("span[class~='caption']").hide();
            $(this).find("input[class~='editor']").fadeIn().focus();
            $(this).find("select[class~='editor']").fadeIn().focus();
        });
  














  
        $(document).on("keydown", ".editor", function(e){
            if(e.keyCode == 13){
                var target = $(e.target);
                var value = target.val();
                var id = target.attr("data-id");
                var data = {id:id, value:value};

                if(target.is(".field-nama")){
                    data.modul = "id_kry";
                }else if(target.is(".field-bayar")){
                    data.modul = "nominal";
                }


                var isi = $(".caption").val();
                // var idtemp = $("#idtempbyrkasbon").val();
                // var kolupdate = $("#kolupdate").val();

                

                $.ajax({
                    type: "post",
                    data : data,
                    url : "proses_update_tempbyrkasbon.php",
                    success : function(a){
                        target.hide();
                        target.siblings("span[class~='caption']").html().fadeIn();

                        alert("Data bayar kasbon diubah");
                    }
                });


                
            }
        });   



        
        $(document).on("click",".hapus-tempbyr", function(){
            var idhapus = $(this).attr("data-id");

            var konfirmasi = confirm("Anda Yakin Ingin Menghapus Data Ini?");

            var idkry = $("#kolupdate").val();

            if(konfirmasi == true){
                $.ajax({
                    type :"POST",
                    url : "proses_hapus_tempbyrkasbon.php",
                    data : {id:idhapus, kryid:idkry},
                    success: function(){
                        // $("tr[data-id='"+id+"']").fadeOut("fast",function(){
                        //     $(this).remove();
                        // });

                        alert("Data Dihapus");
                    }
                });
            }
        });










        // untuk edit pembelian bahan baku
        $(document).on("click", "td", function(){
            $(this).find("span[class~='textbelibhnbaku']").hide();
            $(this).find("input[class~='editbelibhnbaku']").fadeIn().focus();
            $(this).find("select[class~='editbelibhnbaku']").fadeIn().focus();
        });

        $(document).on("keydown", ".editbelibhnbaku", function(e){
            if(e.keyCode == 13){
                var target = $(e.target);
                var value = target.val();
                var id = target.attr("data-id");
                var data = {id:id, value:value};

                if(target.is(".field-tglbeli")){
                    data.modul = "tgl_pembelian";
                }else if(target.is(".field-supplier")){
                    data.modul = "nama_supplier";
                }else if(target.is(".field-pembayaran")){
                    data.modul = "pembayaran";
                }else if(target.is(".field-tgltempo")){
                    data.modul = "tgl_tempo";
                }else if(target.is(".field-keterangan")){
                    data.modul = "keterangan";
                }

                $.ajax({
                    type: "post",
                    data : data,
                    url : "proses_update_belibahanbaku.php",
                    success : function(a){
                        target.hide();
                        target.siblings("span[class~='textbelibhnbaku']").html(value).fadeIn();

                        alert("Data Sudah Diubah");
                    }
                });
            }
        });
    });

    $("#updatestock").prop('disabled', true);

    $("#backupstock").click(function(){
        $.ajax({
            url : "proses/proses_backup_stock.php",
            success : function(a){
                alert(a);
            }
        });
        $("#updatestock").prop('disabled', false);
    });
});
